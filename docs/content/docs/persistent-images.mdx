---
title: Persistent Images
description: Register and reuse in-memory images by keys.
icon: Database
---

This is particularly useful for avoiding redundant image decoding and preload before rendering.

## Usage

It's recommended to declare images in global scope so Takumi can identify and cache them with [`WeakSet`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakSet) reference to the image object.

The image can be used in image's `src` field or `background-image`, `mask-image` CSS property.

```tsx twoslash
/** @jsxImportSource react */
// ---cut-before---
import { ImageResponse } from "@takumi-rs/image-response";
import type { PersistentImage } from "@takumi-rs/core";

const [logo, background] = await Promise.all([
  fetch("/logo.png").then((res) => res.arrayBuffer()),
  fetch("/background.png").then((res) => res.arrayBuffer()),
]);

const persistentImages: PersistentImage[] = [
  {
    src: "my-logo",
    data: logo,
  },
  {
    src: "background",
    data: background,
  },
];

export function GET() {
  return new ImageResponse(<OgImage />, {
    persistentImages,
  });
}

function OgImage() {
  return (
    <div
      style={{
        backgroundImage: "url(background)",
      }}
    >
      <img src="my-logo" />
    </div>
  );
}
```
